<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.cmsz.cmup.fileImporting.dao.FileStatusDAO">

	<select id="checkFileStatus" resultType="com.cmsz.cmup.fileImporting.entity.FileStatusEntity">
		select FILE_NAME,
		FILE_PATH, FILE_STATUS, FILE_PROVINCE,
		LINE_COUNT, FILE_NO, FILE_SUM
		from
		FILECORE_INCOMING_PRO
		where
		 SETTLE_DATE =#{settleDate}
		and FILE_MERCHANT = #{FILE_MERCHANT}
		and FILE_TYPE = #{FILE_TYPE}
		and FILE_STATUS = '2'
		<if test="province != ''" >and FILE_PROVINCE = #{province}</if>
	</select>

	<select id="isInsertedDB" resultType="com.cmsz.cmup.fileImporting.entity.FileStatusEntity">
		select FILE_NAME,
		FILE_PATH, FILE_STATUS, FILE_PROVINCE,
		LINE_COUNT, FILE_NO, FILE_SUM
		from
		FILECORE_INCOMING_PRO
		where
		 SETTLE_DATE =#{settleDate}
		and FILE_MERCHANT = #{FILE_MERCHANT}
		and FILE_TYPE = #{FILE_TYPE}
		and FILE_STATUS = '6'
		<if test="province != ''" >and FILE_PROVINCE = #{province}</if>
	</select>

	<update id="updateArrivedFileStatus" parameterType="java.util.Map">
		update
		FILECORE_INCOMING_PRO
		set FILE_STATUS = '2', STATUS_DESC = '文件到达成功',
		UPDATE_TIME = to_char(sysdate,'yyyymmddhh24miss')
		where
		SETTLE_DATE =#{settleDate}
		and FILE_MERCHANT =#{FILE_MERCHANT}
		and FILE_TYPE = #{FILE_TYPE}
		and FILE_STATUS = '4'
		<if test="province != ''" >and FILE_PROVINCE = #{province}</if>
	</update>

	<update id="updateHandlingFileStatus" parameterType="java.util.Map">
		update
		FILECORE_INCOMING_PRO
		set FILE_STATUS = '4', STATUS_DESC = '正在处理文件',
		UPDATE_TIME = to_char(sysdate,'yyyymmddhh24miss')
		where
		SETTLE_DATE =#{settleDate}
		and FILE_MERCHANT =#{FILE_MERCHANT}
		and FILE_TYPE = #{FILE_TYPE}
		and FILE_STATUS = '2'
		<if test="province != ''" >and FILE_PROVINCE = #{province}</if>
	</update>

	<update id="updateDataErrorFileStatus" parameterType="java.util.Map">
		update
		FILECORE_INCOMING_PRO
		set FILE_STATUS = '5', STATUS_DESC = '数据异常，入库失败',
		FILE_PATH =
		#{errorFilePath}, UPDATE_TIME = to_char(sysdate,'yyyymmddhh24miss')
		where
		SETTLE_DATE =#{settleDate}
		and FILE_MERCHANT =#{FILE_MERCHANT}
		and FILE_TYPE = #{FILE_TYPE}
		and FILE_STATUS = '4'
		<if test="province != ''" >and FILE_PROVINCE = #{province}</if>
		<if test="ERROR_FILE_DELETE != 'DELETE_ALL'">and FILE_NAME=#{fileName}</if>
	</update>

	<update id="updateInsertDBSuccessFileStatus" parameterType="java.util.Map">
		update FILECORE_INCOMING_PRO
		set FILE_STATUS = '6', STATUS_DESC = '入库成功',
		UPDATE_TIME = to_char(sysdate,'yyyymmddhh24miss')
		where
		SETTLE_DATE =#{settleDate}
		and FILE_MERCHANT =#{FILE_MERCHANT}
		and FILE_TYPE = #{FILE_TYPE}
		and FILE_STATUS = '4'
		<if test="province != ''" >and FILE_PROVINCE = #{province}</if>
	</update>

</mapper>