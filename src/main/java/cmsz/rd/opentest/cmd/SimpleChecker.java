package cmsz.rd.opentest.cmd;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

/**
 * Created by admin on 2017/4/29.
 */
public class SimpleChecker implements Checker {
    private Logger logger = LoggerFactory.getLogger(this.getClass());

    private volatile boolean haserror= false;

    private List<String> errlist=new ArrayList<>();

    private List<String> errlines=new ArrayList<>();

    public SimpleChecker(String errString){
        if(errString!=null){
            errlist.add(errString);
        }
    }

    public SimpleChecker(String[] errs){
        if(errs!=null && errs.length >0){
            errlist.addAll(Arrays.asList(errs));
        }
    }

    public void addErrorKey(String errorkey){
        errlist.add(errorkey);
    }

    @Override
    public void check(String line) {
        for(String s : errlist){
            logger.debug("check @"+line + " ##@@" + s);
            if( line.indexOf(s) > -1) {
                haserror = true;
                errlines.add(line + " ##@@"+s);
            }
        }
    }

    @Override
    public boolean hasError() {
        return  this.haserror;
    }

    @Override
    public String getErrorMsg() {
        StringBuilder sb = new StringBuilder();
        int i=0;
        for(String s: errlines){
            sb.append(i).append("::\t").append(s).append("\n");
            i++;
        }
        return sb.toString();
    }


    public static SimpleChecker getShellCommonChecker(){
        return new SimpleChecker(new String[]{
                "No such file or directory",
                "Permission denied",
                "timed out"
        });
    }

}
