package cmsz.rd.opentest.file.validator.impl;

import cmsz.rd.opentest.file.validator.Filter;
import cmsz.rd.opentest.file.validator.FilterChain;
import cmsz.rd.opentest.file.validator.Section;
import cmsz.rd.opentest.file.validator.ValidateException;

import java.util.List;


/**
 * 校验器链表处理类
 * 
 * @author lenovo
 *
 */
public class FilterChainImpl implements FilterChain {

	private List<Filter> filterlist;
	private int index = 0;
	private InnerChain innerChain = new InnerChain();

	public void doFilter(Section section) throws Exception {
		index = 0;
		innerChain.doFilter(section);
	}

	public Filter getMatchedFilter() {
		return innerChain.getMatchedFilter();
	}

	protected class InnerChain implements FilterChain {
		private Filter currFilter = null;

		public void doFilter(Section section) throws Exception {

			// 判断此数据行是否为空行
			if ("".equals(section.getContent()) || section.getContent() == null || section.getContent().length() == 0) {
				throw new ValidateException(section, ValidateException.CODE_BLANKLINE,
						ValidateException.EMSG_BLANKLINE);
			}

			int size = filterlist.size();
			if (index < size) {
				currFilter = filterlist.get(index++);
				currFilter.doFilter(section, innerChain);
			} else {
				currFilter = null;
				throw new ValidateException(section, ValidateException.CODE_NOFILTER, ValidateException.EMSG_NOFILTER);
			}
		}

		public Filter getMatchedFilter() {
			return currFilter;
		}

	}

	public List<Filter> getFilterlist() {
		return filterlist;
	}

	public void setFilterlist(List<Filter> filterlist) {
		this.filterlist = filterlist;
	}

}
